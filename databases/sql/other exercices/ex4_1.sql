CREATE DATABASE HOSPITAL;
USE HOSPITAL;
CREATE TABLE PATIENT(NOPATIENT INT PRIMARY KEY, NOASSSOCIALE INT, NOM VARCHAR(50), PRENOM VARCHAR(50));
CREATE TABLE MEDECIN(NOMEDECIN INT PRIMARY KEY, NOM VARCHAR(50), PRENOM VARCHAR(50));
CREATE TABLE DIAGNOSTIC(NODIAGNOSTIC INT PRIMARY KEY, DESCRIPTION VARCHAR(300));
CREATE TABLE TRAITEMENT(NOTRAITEMENT INT PRIMARY KEY, DESCRIPTION VARCHAR(300));
CREATE TABLE ENTREE_DOSSIER(NODOSSIER INT PRIMARY KEY, DATEVISITE DATE, NOPATIENT INT, NOMEDECIN int,
			 NOTRAITEMENT INT, NODIAGNOSTIC INT,CONSTRAINT 
             FOREIGN KEY (NOPATIENT) REFERENCES PATIENT(NOPATIENT),
             FOREIGN KEY (NOMEDECIN) REFERENCES MEDECIN(NOMEDECIN),
             FOREIGN KEY (NOTRAITEMENT) REFERENCES TRAITEMENT(NOTRAITEMENT),
             FOREIGN KEY (NODIAGNOSTIC)REFERENCES DIAGNOSTIC(NODIAGNOSTIC));
             
ALTER TABLE DIAGNOSTIC
MODIFY DESCRIPTION VARCHAR(255);

ALTER TABLE PATIENT 
ADD COLUMN NOTELEPHONE VARCHAR(20),
ADD COLUMN DATENAISSANCE DATE;

INSERT INTO PATIENT VALUES (111111,12345678,'Delisle','Pierre','22 33 44 33 22','1977-04-11'),
(111112,87654321,'Delisle','Sylvain','33 22 44 33 55','1975-08-21'),
(111113,23234433,'Tremblay','Sylvain','418-275-1232','1980-01-30');
INSERT INTO MEDECIN VALUES(12345,'Lajoie','René'),(67899,'Dion','Céline');

INSERT INTO DIAGNOSTIC VALUES(1,'Maigraine'),(2,'Facture au bras');

INSERT INTO TRAITEMENT VALUES(1,'2 Cachets à toutes les 4 heures'),(2,'Placer le bras dans un plâtre');

INSERT INTO ENTREE_DOSSIER VALUES (1,'2008-04-25',111111,12345,1,1),(2,'2008-04-26',111111,67899,2,2),
(3,'2008-04-26',111111,12345,1,2),(4,'2008-04-26',111112,67899,1,1);


UPDATE ENTREE_DOSSIER SET NOTRAITEMENT = 2 WHERE NODOSSIER =3;

SELECT * FROM PATIENT;

SELECT NOM, PRENOM FROM PATIENT;

SELECT NOM,PRENOM FROM PATIENT WHERE NOM = 'Délisle';

SELECT NOM, PRENOM FROM PATIENT WHERE YEAR(DATENAISSANCE) > 1976;
SELECT DISTINCT NOM FROM PATIENT;
SELECT * FROM PATIENT ORDER BY DATENAISSANCE;

SELECT * FROM ENTREE_DOSSIER WHERE NOPATIENT = 111111 AND NOMEDECIN = 67899;

SELECT E.*, P.* FROM ENTREE_DOSSIER E LEFT JOIN PATIENT P ON E.NOPATIENT = P.NOPATIENT;

SELECT E.* FROM ENTREE_DOSSIER E INNER JOIN PATIENT P ON E.NOPATIENT = P.NOPATIENT WHERE P.NOPATIENT = 111111;

SELECT T.DESCRIPTION FROM TRAITEMENT T INNER JOIN ENTREE_DOSSIER E ON T.NOTRAITEMENT = E.NOTRAITEMENT
WHERE E.NOPATIENT = 111111 ;

SELECT P.NOM, P.PRENOM FROM PATIENT P INNER JOIN ENTREE_DOSSIER E ON P.NOPATIENT = E.NOPATIENT
INNER JOIN MEDECIN M ON E.NOMEDECIN = M.NOMEDECIN
WHERE M.NOM = 'lajoie' AND M.PRENOM = 'René' AND DATEVISITE = '2008-04-26' ORDER BY P.DATENAISSANCE;